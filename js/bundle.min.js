window.escapeHTML=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},window.escapeDoubleQuotes=function(e){return(""+e).replace(/"/g,'\\"').replace(/\\/g,"\\\\")},window.toTimestamp=function(e){if("number"==typeof e)return e;try{return new Date(e).getTime()}catch(e){return 1}},window.DATA_DISPOSITION="melted",window.DATA_COLS_ORDER=[],window.DECIMALS_MAX=2,window.DECIMALS_FIXED=!1,window.VARIABLES={weather_state:{display:!0,var_name:"weather_state",states:{sunny:{value:"sunny",image:"./image/sunny.png"},partly_cloudy:{value:"partly_cloudy",image:"./image/partly_cloudy.png"},cloudy:{value:"cloudy",image:"./image/cloudy.png"},rain_heavy:{value:"rain_heavy",image:"./image/rain_heavy.png"},rain_light:{value:"rain_light",image:"./image/rain_light.png"},rain:{value:"rain",image:"./image/rain.png"},snow:{value:"snow",image:"./image/snow.png"},thunderstorms:{value:"thunderstorms",image:"./image/thunderstorms.png"}}},temperature:{display:!0,var_name:"temp",mag:"c"},rainfall:{display:!0,var_name:"rainfall",mag:"%",conv_factor:1},humidity:{display:!0,var_name:"humidity",mag:"%",conv_factor:1},wind_speed:{display:!0,var_name:"wind_speed",mag:" m/s",conv_factor:1},visibility:{display:!0,var_name:"visibility",mag:" m",conv_factor:1},wind_gust:{display:!0,var_name:"wind_gust",mag:" m/s",conv_factor:1},dew_point:{display:!0,var_name:"dew_point",mag:" °C",conv_factor:1},pressure:{display:!0,var_name:"pressure",mag:" hPa",conv_factor:1}},window.extraVariableDisplay=["rainfall","humidity","wind_speed","visibility","wind_gust","pressure"],window.LOCALES={variables:{weather_state:{states:{sunny:{en:"Sunny"},partly_cloudy:{en:"Partly Cloudy"},cloudy:{en:"Cloudy"},rain_heavy:{en:"Rain (Heavy)"},rain_light:{en:"Rain (Light)"},rain:{en:"Rain"},snow:{en:"Snow"},thunderstorms:{en:"Thunderstorms"}}},temperature:{name:{en:"Temperature"},units:{celsius:{en:"Celsius degrees"},fahrenheit:{en:"Fahrenheit degrees"}}},humidity:{name:{en:"Humidity"}},wind_speed:{name:{en:"Wind Speed"}},wind_gust:{name:{en:"Wind Gust"}},visibility:{name:{en:"Visibility"}},dew_point:{name:{en:"Dew Point"}},pressure:{name:{en:"Pressure"}},rainfall:{name:{en:"Rainfall"}}}},window.getText=function(e){for(var t=(""+e).split("."),a=window.LOCALES||{},n=0;n<t.length;n++)a=a[t[n]]||{};return a&&(a[navigator.language]||a.en)||e},window.LAYOUT_DIRECTION="horizontal",window.tweekConfiguration=function(){window.LAYOUT_DIRECTION=(DeepIntelligence.param("layout")||"horizontal").toLowerCase();var e=Object.keys(VARIABLES);if(DeepIntelligence.param("variables:display")){for(var t=(DeepIntelligence.param("variables:display")+"").split(",").map(function(e){return e.trim().toLowerCase().replace(/\s/g,"_")}).filter(function(e){return!!VARIABLES[e].var_name}),a=0;a<e.length;a++){var n=e[a];VARIABLES[n].display=0<=t.indexOf(n)}window.extraVariableDisplay=t.filter(function(e){return"weather_state"!==e&&"temperature"!==e})}DeepIntelligence.param("temperature:var")&&(VARIABLES.temperature.var_name=DeepIntelligence.param("temperature:var")+""),DeepIntelligence.param("temperature:mag")&&(VARIABLES.temperature.mag=(DeepIntelligence.param("temperature:mag")+"").trim().substr(0,1).toLowerCase()),DeepIntelligence.param("humidity:var")&&(VARIABLES.humidity.var_name=DeepIntelligence.param("humidity:var")+""),DeepIntelligence.param("humidity:mag")&&(VARIABLES.humidity.mag=DeepIntelligence.param("humidity:mag")+""),DeepIntelligence.param("humidity:cf")&&(VARIABLES.humidity.conv_factor=Number(DeepIntelligence.param("humidity:cf")+"")||1),DeepIntelligence.param("wind_speed:var")&&(VARIABLES.wind_speed.var_name=DeepIntelligence.param("wind_speed:var")+""),DeepIntelligence.param("wind_speed:mag")&&(VARIABLES.wind_speed.mag=DeepIntelligence.param("wind_speed:mag")+""),DeepIntelligence.param("wind_speed:cf")&&(VARIABLES.wind_speed.conv_factor=Number(DeepIntelligence.param("wind_speed:cf")+"")||1),DeepIntelligence.param("wind_gust:var")&&(VARIABLES.wind_gust.var_name=DeepIntelligence.param("wind_gust:var")+""),DeepIntelligence.param("wind_gust:mag")&&(VARIABLES.wind_gust.mag=DeepIntelligence.param("wind_gust:mag")+""),DeepIntelligence.param("wind_gust:cf")&&(VARIABLES.wind_gust.conv_factor=Number(DeepIntelligence.param("wind_gust:cf")+"")||1),DeepIntelligence.param("pressure:var")&&(VARIABLES.pressure.var_name=DeepIntelligence.param("pressure:var")+""),DeepIntelligence.param("pressure:mag")&&(VARIABLES.pressure.mag=DeepIntelligence.param("pressure:mag")+""),DeepIntelligence.param("pressure:cf")&&(VARIABLES.pressure.conv_factor=Number(DeepIntelligence.param("pressure:cf")+"")||1),DeepIntelligence.param("visibility:var")&&(VARIABLES.visibility.var_name=DeepIntelligence.param("visibility:var")+""),DeepIntelligence.param("visibility:mag")&&(VARIABLES.visibility.mag=DeepIntelligence.param("visibility:mag")+""),DeepIntelligence.param("visibility:cf")&&(VARIABLES.visibility.conv_factor=Number(DeepIntelligence.param("visibility:cf")+"")||1),DeepIntelligence.param("dew_point:var")&&(VARIABLES.dew_point.var_name=DeepIntelligence.param("dew_point:var")+""),DeepIntelligence.param("dew_point:mag")&&(VARIABLES.dew_point.mag=DeepIntelligence.param("dew_point:mag")+""),DeepIntelligence.param("dew_point:cf")&&(VARIABLES.dew_point.conv_factor=Number(DeepIntelligence.param("dew_point:cf")+"")||1)},window.DeepIntelligence={},DeepIntelligence.loaded=!1,DeepIntelligence.url=window.ENV_API_URL||"https://app.deepint.net/",DeepIntelligence.token="",DeepIntelligence.readyListeners=[],DeepIntelligence.dataCallback=null;var getParameterByName=function(e,t){t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null},jsonGET=function(e,t){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState)if(200===this.status)try{return t(JSON.parse(this.responseText))}catch(e){return console.error(e),t(null)}else{if(404===this.status)return t(null);0!==this.status&&503!==this.status&&503!==this.status||setTimeout(function(){jsonGET(e,t)},500)}},a.open("GET",e,!0),a.send()};function getWeatherState(e){e+="";for(var t=VARIABLES.weather_state.states,a=Object.keys(t),n=0;n<a.length;n++)if(t[a[n]].value===e)return{id:a[n],image:t[a[n]].image,name:"variables.weather_state.states."+a[n]};return{id:"sunny",image:VARIABLES.weather_state.states.sunny.image,name:"variables.weather_state.states.sunny"}}function renderTemperature(){var e=temperatureInC;return"f"===temperatureCurrentUnits&&(e=1.8*e+32),renderNumber(e)}function renderVariable(e,t){return e=Number(e),isNaN(e)?"-":renderNumber(e)+""+t}function setContents(e){document.querySelector("#container").innerHTML=e}function renderMyCustomGraph(e){setContents(renderVisualization(e))}function deepintCustomView(){DeepIntelligence.ready(function(){if(tweekConfiguration(),null===DeepIntelligence.param("data:timestamp"))return setContents(renderError("Missing required parameter: 'data:timestamp' (position of timestamp in the data)"));if(null===DeepIntelligence.param("data:variable"))return setContents(renderError("Missing required parameter: 'data:variable' (position of variable name in the data)"));if(null===DeepIntelligence.param("data:value"))return setContents(renderError("Missing required parameter: 'data:value' (position of value in the data)"));var e=parseInt(DeepIntelligence.param("data:timestamp")||"0",10),t=parseInt(DeepIntelligence.param("data:variable")||"1",10),a=parseInt(DeepIntelligence.param("data:value")||"2",10);DeepIntelligence.fetchData([e,t,a],function(e,t,a,n){if(e)return setContents(renderError(e.message));try{prepareData(a,renderMyCustomGraph)}catch(e){setContents(renderError(e.message))}})})}DeepIntelligence.onload=function(){this.loaded=!0,this.token=this.param("di_token")||"";for(var e=0;e<this.readyListeners.length;e++)try{this.readyListeners[e]()}catch(e){console.error(e)}},DeepIntelligence.param=function(e){return getParameterByName(encodeURIComponent(e))},DeepIntelligence.ready=function(e){if("function"!=typeof e)return this.loaded;this.loaded?setTimeout(e,0):this.readyListeners.push(e)},DeepIntelligence.fetchData=function(e,t){if(e=t?e?e.join(","):"":(t=e,""),!this.token)return t(new Error("Could not fetch visualization data. No token provided."));jsonGET(new URL("/api/views/custom/fetch?token="+encodeURIComponent(this.token)+"&projection="+encodeURIComponent(e),this.url).toString(),function(e){return null===e?t(new Error("Could not fetch visualization data. Invalid or expired token provided.")):t(null,e.features,e.instances,e.projection)}.bind(this))},"complete"===document.readyState?DeepIntelligence.onload():document.addEventListener("DOMContentLoaded",DeepIntelligence.onload.bind(DeepIntelligence)),window.prepareData=function(e,t){if("cols"===window.DATA_DISPOSITION)throw new Error("Data disposition 'cols' not yet supported.");prepareDataMelted(e,t)},window.prepareDataMelted=function(e,t){for(var a=Object.create(null),n=Object.create(null),r=new Map,i=Object.keys(VARIABLES),s=0;s<i.length;s++)r.set(VARIABLES[i[s]].var_name,i[s]);for(s=0;s<e.length;s++){var l=e[s],p=toTimestamp(l[0]),o=l[1],l=l[2],o=r.get(o);o&&(n[o]||0)<p&&(n[o]=p,a[o]=l)}t(a)},window.renderError=function(e){return'<div class="error"><b>Error:</b> '+escapeHTML(e)+"</div>"},window.renderNumber=function(e){e=Number(e);return isNaN(e)?"??":isFinite(e)?(e=Math.round(e*Math.pow(10,DECIMALS_MAX))/Math.pow(10,DECIMALS_MAX),DECIMALS_FIXED&&(e=e.toFixed(DECIMALS_MAX)),""+e):0<e?"∞":"-∞"},window.updateTemperature=function(e){"c"===e?(document.querySelector(".temp-switch-c").classList.add("chosen"),document.querySelector(".temp-switch-f").classList.remove("chosen")):(document.querySelector(".temp-switch-f").classList.add("chosen"),document.querySelector(".temp-switch-c").classList.remove("chosen")),window.temperatureCurrentUnits=e,document.querySelector(".temperature").innerHTML=escapeHTML(renderTemperature()),window.localStorage&&localStorage.setItem("tmag",e)},window.temperatureInC=0,window.temperatureCurrentUnits=window.localStorage&&localStorage.getItem("tmag")||"c",window.renderVisualization=function(e){var t,a="";console.log(e),a+='<div class="weather-indicator">',VARIABLES.weather_state.display&&(a+='<div class="weather-state-container">',t=getWeatherState(e.weather_state),a+='<img src="'+escapeDoubleQuotes(t.image)+'" alt="'+escapeDoubleQuotes(getText(t.name))+'" title="'+escapeDoubleQuotes(getText(t.name))+'" class="weather-state">',a+="</div>"),VARIABLES.temperature.display&&(a+='<div class="temperature-container">',t=Number(e.temperature),"f"===VARIABLES.temperature.mag&&(t=(t-32)/1.8),window.temperatureInC=t,a+='<span class="temperature" title="'+escapeDoubleQuotes(getText("variables.temperature.name"))+'">'+renderTemperature()+"</span>",a+='<span class="temp-switch">',a+='<span onclick="updateTemperature(\'c\')" class="temp-switch-c'+("f"===temperatureCurrentUnits?"":" chosen")+'" title="'+escapeDoubleQuotes(getText("variables.temperature.units.celsius"))+'">°C</span>',a+='<span onclick="updateTemperature(\'f\')" class="temp-switch-f'+("f"===temperatureCurrentUnits?" chosen":"")+'" title="'+escapeDoubleQuotes(getText("variables.temperature.units.fahrenheit"))+'">°F</span>',a+="</span>",a+="</div>"),"vertical"===LAYOUT_DIRECTION&&(a+='<div class="vertical-split">&nbsp</div>');for(var n=3,r=!1,i=0;i<extraVariableDisplay.length;i++){var s=extraVariableDisplay[i],l=Number(e[s])*(VARIABLES[s].conv_factor||1);VARIABLES[s].display&&(3<=n&&(r&&(r=!1,a+="</div>"),a+='<div class="triple-variable">',r=!(n=0)),n++,a+='<span class="single-variable"><b>'+escapeHTML(getText("variables."+s+".name"))+":</b> "+escapeHTML(renderVariable(l,VARIABLES[s].mag))+"</span>")}return r&&(r=!1,a+="</div>"),a+="</div>"},deepintCustomView();